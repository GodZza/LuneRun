# 动态轨道系统验证指南

## 前提条件
- Unity编辑器已打开
- DynamicTrack.cs已成功编译（无ERROR）
- Level.cs已启用DynamicTrack功能
- 游戏场景已设置

## 验证步骤

### 步骤1：编译检查
在Unity编辑器中检查Console窗口：
```
✓ 应该看到编译成功的消息
✓ 不应该有红色的ERROR消息
✓ 可以有一些黄色的WARNING或INFO消息
```

### 步骤2：启动游戏
按Play按钮启动游戏，观察：
```
✓ 玩家应该出现在轨道起点
✓ 应该看到DynamicTrack的初始化日志
✓ Console应该显示："Created with levelId=X, loadForward=6, keepBackward=2"
```

### 步骤3：初始轨道检查
在Unity中检查Scene视图：
```
✓ 应该看到初始生成的轨道段（8个）
✓ 每个段应该有多个Part
✓ 轨道应该向前延伸（沿Z轴正方向）
```

### 步骤4：运行时动态加载
玩家向前跑动时观察：
```
✓ 玩家接近轨道末端时（距离<200）
✓ 应该看到日志："Player near end (distance=XXX), should load more"
✓ 应该看到日志："Loading segment #N, difficulty=0.XX"
✓ 应该看到日志："Segment loaded, total segments=X"
```

### 步骤5：运行时动态卸载
玩家继续前进时观察：
```
✓ 玩家远离起点时（距离>300）
✓ 应该看到日志："Player far from start (distance=XXX), should remove old segment"
✓ 应该看到日志："Removing segment: SegmentName"
✓ 应该看到日志："Segment removed, remaining segments=X"
```

### 步骤6：段数量稳定
游戏运行一段时间后：
```
✓ 轨道段数量应该保持在6-8个左右
✓ 不应该无限增长（避免内存泄漏）
✓ 不应该完全清空（保持玩家周围有足够轨道）
```

### 步骤7：难度递增
观察不同关卡：
```
关卡1-10：  应该看到很多ForwardSegment（简单）
关卡11-20： 应该开始看到Hill、Curve、Hole（中等）
关卡21-30： 应该看到Loop、LongJump、Island（困难）
关卡31-50： 应该看到所有类型的混合（极难）
```

## 关键日志消息

### 初始化日志
```
[DynamicTrack] Created with levelId=1, loadForward=6, keepBackward=2
[DynamicTrack] Generating initial track with 8 segments, difficulty=0.02
[DynamicTrack] Initialized 8 segment generators
[TrackGenerator] Generated segment, total segments: 1
...
```

### 运行时日志
```
[DynamicTrack] Player near end (distance=180.50), should load more
[DynamicTrack] Loading segment #8, difficulty=0.02
[TrackGenerator] Generated segment, total segments: 9
[DynamicTrack] Segment loaded, total segments=9
```

### 卸载日志
```
[DynamicTrack] Player far from start (distance=350.20), should remove old segment
[DynamicTrack] Removing segment: XSegment
[DynamicTrack] Segment removed, remaining segments=8
```

## 常见问题排查

### 问题1：轨道不生成
**症状**：玩家跑完初始轨道后，没有新轨道生成

**检查**：
1. 查看Console是否看到"Player near end"消息
2. 检查玩家的Z坐标是否在增长
3. 验证DynamicTrack.Update是否被调用（在Level.Update中）
4. 检查_shouldLoadMore()方法的距离计算

### 问题2：轨道不卸载
**症状**：轨道段数量持续增长

**检查**：
1. 查看Console是否看到"Player far from start"消息
2. 验证_removeDistance阈值（默认300）
3. 检查玩家的Z坐标是否足够大
4. 验证_shouldRemoveOld()方法的条件

### 问题3：生成器不工作
**症状**：只生成ForwardSegment，没有其他类型

**检查**：
1. 查看难度值是否正确（levelId/50）
2. 验证生成器的CanRun()方法
3. 检查随机数生成器是否工作
4. 验证TrackGenerator是否正确选择生成器

### 问题4：段之间断开
**症状**：轨道段之间有间隙

**检查**：
1. 验证ConnectLastSegments()方法
2. 检查连接点的位置计算
3. 确认段的GetConnectPart()方法
4. 验证段的连接逻辑

## 调试工具

### 启用详细日志
在DynamicTrack.cs中设置：
```csharp
private bool _debugMode = true; // 启用详细日志
```

### 监控段数量
添加UI显示（可选）：
```csharp
void OnGUI() {
    GUI.Label(new Rect(10, 10, 300, 20), 
              $"Segments: {_track.GetSegments().Count}");
}
```

### 性能监控
使用Unity Profiler：
- Track.GetClosestPart的CPU时间
- Update方法的执行时间
- 内存使用情况（GC Alloc）

## 成功标准

✅ 所有8种生成器都被使用
✅ 段数量保持稳定（6-8个）
✅ 轨道无限延伸
✅ 无内存泄漏
✅ 性能可接受（<5ms per frame）
✅ 无段断开
✅ 难度递增正确
