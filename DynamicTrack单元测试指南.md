# DynamicTrack 单元测试指南

## 概述

本指南介绍如何使用 `DynamicTrackUnitTest` 脚本对动态轨道系统进行单元测试。这个测试场景不依赖完整的游戏流程，直接测试 DynamicTrack 的核心功能。

## 快速开始

### 步骤 1: 创建测试场景

1. 在 Unity 中打开项目
2. 创建新场景：`File > New Scene` 或 `Ctrl+N`
3. 保存场景：`File > Save As`，命名为 `DynamicTrackUnitTest`

### 步骤 2: 设置测试对象

1. 在 Hierarchy 窗口中，右键点击 `Create Empty`
2. 命名为 `DynamicTrackUnitTest`
3. 在 Inspector 窗口中，点击 `Add Component`
4. 搜索并添加 `DynamicTrackUnitTest` 脚本

### 步骤 3: 配置测试参数

在 Inspector 窗口中，你可以调整以下参数：

**测试配置：**
- `Auto Run On Start`: 是否在场景加载时自动运行测试（默认勾选）
- `Test Level Id`: 测试的关卡 ID（默认 1）

**轨道配置：**
- `Load Forward`: 向前方加载多少个轨道段（默认 6）
- `Keep Backward`: 向后方保留多少个轨道段（默认 2）

**测试参数：**
- `Test Speed`: 模拟玩家移动速度（默认 20 单位/秒）
- `Test Distance`: 测试移动的总距离（默认 500 单位）

### 步骤 4: 运行测试

1. 点击 Unity 编辑器顶部的 `Play` 按钮
2. 测试将自动运行（如果 `Auto Run On Start` 勾选）
3. 观察控制台输出和屏幕上的 UI

## 测试功能

### 自动化测试流程

1. **初始化阶段**
   - 创建测试 Level 实例
   - 创建 DynamicTrack 实例
   - 记录初始轨道段数

2. **测试阶段**
   - 模拟玩家向前移动（Z 轴）
   - 动态轨道系统根据玩家位置加载/卸载轨道段
   - 超时保护（30 秒）

3. **验证阶段**
   - 检查移动距离是否达标
   - 验证轨道段数量是否合理
   - 输出详细统计信息

### 测试验证标准

**测试通过条件：**
- 玩家移动距离 ≥ 测试距离的 50%
- 最终轨道段数量 > 0
- 轨道段数量在合理范围内（3-12 个段）

**测试失败条件：**
- 移动距离不足
- 没有轨道段
- 其他严重错误

## 控制快捷键

在测试运行时，可以使用以下快捷键：

- **[T]**: 开始测试（仅在待机状态下有效）
- **[S]**: 查看统计信息
- **[R]**: 重置测试

## UI 界面说明

测试运行时，屏幕左上角会显示：

1. **测试状态**
   - 当前是"测试中..."还是"待机"

2. **测试结果**
   - 显示最新的测试结果

3. **实时信息**
   - 当前轨道段数量
   - 玩家 Z 坐标
   - 测试进度（当前距离 / 目标距离）

4. **控制按钮**
   - 初始化测试环境
   - 开始测试
   - 查看统计
   - 重置

## 控制台输出

测试运行时，控制台会输出详细日志：

```
========== DynamicTrack 单元测试场景 ==========
初始化测试环境...
[1/4] 创建测试 Level (LevelId: 1)
[2/4] 创建 DynamicTrack (forward=6, backward=2)
[3/4] 初始状态: 8 个轨道段
[4/4] 测试环境准备完成
===========================================
========== 开始测试 ==========
初始段数: 8
测试速度: 20 单位/秒
测试距离: 500 单位
========== 测试结果: 通过 ==========
测试统计:
  测试时间: 25.00 秒
  移动距离: 500.00 单位
  初始段数: 8
  最终段数: 8
  卸载段数: 0
  配置参数: 前方加载=6, 后方保留=2
动态轨道统计:
...
===========================================
```

## 故障排查

### 问题 1: 初始化失败

**症状：** 显示"初始化失败"

**解决方案：**
1. 检查 DynamicTrack.cs 是否存在且无编译错误
2. 检查 Track.cs 是否正确配置
3. 查看 Console 中的详细错误信息

### 问题 2: 测试超时

**症状：** 显示"测试超时（30秒），强制结束"

**解决方案：**
1. 降低 `Test Speed` 值
2. 降低 `Test Distance` 值
3. 检查是否有性能瓶颈

### 问题 3: 轨道段数异常

**症状：** 轨道段数过多或过少

**解决方案：**
1. 调整 `Load Forward` 和 `Keep Backward` 参数
2. 检查轨道生成器是否正常工作
3. 检查 LevelId 对应的关卡数据

### 问题 4: 移动距离不足

**症状：** 显示"移动距离不足"

**解决方案：**
1. 增加 `Test Speed` 值
2. 增加 `Test Distance` 值
3. 检查 DynamicTrack.Update() 是否被正确调用

## 高级用法

### 自定义测试参数

根据你的需求，可以创建多个测试场景，每个场景使用不同的参数：

**场景 A: 基本功能测试**
- Load Forward: 3
- Keep Backward: 1
- Test Distance: 100

**场景 B: 长距离测试**
- Load Forward: 6
- Keep Backward: 2
- Test Distance: 1000

**场景 C: 压力测试**
- Load Forward: 10
- Keep Backward: 5
- Test Distance: 2000

### 多关卡测试

可以修改脚本中的 `testLevelId` 来测试不同关卡：

```csharp
[SerializeField] private int testLevelId = 1;  // 改为 2, 3, 4...
```

### 集成到 CI/CD

可以将此测试脚本集成到持续集成系统中，通过命令行参数控制测试。

## 相关文件

- `Assets/Scripts/DynamicTrackUnitTest.cs` - 单元测试脚本
- `Assets/Scripts/com/playchilla/runner/track/DynamicTrack.cs` - 动态轨道系统
- `动态轨道验证指南.md` - 完整验证指南
- `动态轨道快速入门.md` - 3 分钟快速验证

## 联系支持

如果遇到问题或需要帮助，请：
1. 查看 Console 中的详细错误信息
2. 检查相关文档
3. 分析代码逻辑

## 更新日志

**v1.0** (当前版本)
- 初始版本
- 基本测试功能
- UI 界面
- 快捷键支持
